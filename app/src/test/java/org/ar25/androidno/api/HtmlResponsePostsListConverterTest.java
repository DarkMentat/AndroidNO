package org.ar25.androidno.api;

import org.ar25.androidno.BuildConfig;
import org.ar25.androidno.entities.Post;
import org.junit.Rule;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.powermock.api.mockito.PowerMockito;
import org.powermock.core.classloader.annotations.PowerMockIgnore;
import org.powermock.core.classloader.annotations.PrepareForTest;
import org.powermock.modules.junit4.rule.PowerMockRule;
import org.robolectric.RobolectricGradleTestRunner;
import org.robolectric.annotation.Config;

import java.util.ArrayList;
import java.util.List;

import okhttp3.ResponseBody;

import static org.junit.Assert.assertTrue;


@RunWith(RobolectricGradleTestRunner.class)
@Config(constants = BuildConfig.class, sdk = 21)
@PowerMockIgnore({ "org.mockito.*", "org.robolectric.*", "android.*" })
@PrepareForTest({ ResponseBody.class })
public class HtmlResponsePostsListConverterTest {

  String mTestHtml = "<!DOCTYPE html><html lang=\"uk\" dir=\"ltr\" class=\"no-js\"><head> <meta charset=\"utf-8\"/><link rel=\"shortcut icon\" href=\"https://ar25.org/sites/all/storage/default_images/theme/favicon.ico\" type=\"image/vnd.microsoft.icon\"/><meta name=\"abstract\" content=\"Статті\"/><meta name=\"generator\" content=\"Drupal 7 (http://drupal.org)\"/><meta name=\"rights\" content=\"Народний Оглядач\"/><link rel=\"canonical\" href=\"http://ar25.org/svity\"/><link rel=\"shortlink\" href=\"http://ar25.org/taxonomy/term/684\"/> <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\"> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> <title>Світи | Народний Оглядач</title></head><body class=\"html not-front not-logged-in two-sidebars page-taxonomy page-taxonomy-term page-taxonomy-term- page-taxonomy-term-684 i18n-uk with-navigation with-subnav section-svity\" > <div id=\"page\" xmlns=\"http://www.w3.org/1999/html\"> <div class=\"head-panel\"> <form class=\"google-cse\" action=\"/svity\" method=\"post\" id=\"search-block-form\" accept-charset=\"UTF-8\"><div> <input title=\"Введіть терміни, які ви хочете знайти.\" placeholder=\"пошук...\" type=\"search\" id=\"edit-search-block-form--2\" name=\"search_block_form\" value=\"\" size=\"15\" maxlength=\"128\" class=\"form-text\"/><input type=\"submit\" id=\"edit-submit\" name=\"op\" value=\"Пошук\" class=\"form-submit\"/><input type=\"hidden\" name=\"form_id\" value=\"search_block_form\"/></div></form></div><header class=\"header\" role=\"banner\"> <a href=\"/\" class=\"logo\" title=\"Головна\"></a> <section class=\"description\"> <h1 class=\"site-name\"> <a href=\"/\" title=\"Головна\" rel=\"home\">Народний Оглядач</a> </h1> <div class=\"slogan\">Портал світоглядних новин SD.ORG.UA </br>Сонячна етномережа AR25.ORG</div><div class=\"time\">5 Вересень 2016 р., Понеділок, Київський час 19:07 </br>Статей за останні 24 години - 6 </div></section> <section id=\"block-block-14\" class=\"block block-block block-even\"> <div class=\"content\"> <p class=\"first\">Розсилка новин<strong>Ранкова пошта</strong></p><a class=\"observer-lists-subscribe\" title=\"Підписка\" href=\"/lists\"></a><p class=\"last\">Підписатися</p></div></section> </header> <nav id=\"main-menu\" role=\"navigation\"> </nav> <nav> </nav> <div class=\"breadcrumb\"><a href=\"/\">Головна</a> » <span class=\"nolink\">Тексти</span></div><div id=\"main\" class=\"main column\"> <h1 class=\"page-title\">Світи<div class=\"rss2\"></div></h1> <div class=\"container\"> <div class=\"container2\"> <div style=\"display:block;\"></div><ul class=\"action-links\"></ul> <div class=\"view view-page-taxonomy-term view-id-page_taxonomy_term view-display-id-page_term view-dom-id-1f85c8b420b7257377e87038e9ca9fad\"> <div class=\"view-header\"> <div class='term-description'></div></div><div class=\"view-filters\"> <form action=\"/svity\" method=\"get\" id=\"views-exposed-form-page-taxonomy-term-page-term\" accept-charset=\"UTF-8\"><div><div class=\"views-exposed-form\"> <div class=\"views-exposed-widgets clearfix\"> <div id=\"edit-created-wrapper\" class=\"views-exposed-widget views-widget-filter-created\"> <div class=\"views-widget\"> <div class=\"form-item form-type-select form-item-created\"> <select id=\"edit-created\" name=\"created\" class=\"form-select\"><option value=\"All\" selected=\"selected\">за весь час</option><option value=\"1\">за день</option><option value=\"2\">за тиждень</option><option value=\"3\">за місяць</option></select></div></div></div><div id=\"checkboxes-wrapper\" class=\"views-exposed-widget views-widget-checkboxes\"> <div class=\"views-widget\"> <div class=\"form-item form-type-checkbox form-item-timestamp\"> <input type=\"checkbox\" id=\"edit-timestamp\" name=\"timestamp\" value=\"1\" class=\"form-checkbox\"/> <label class=\"option\" for=\"edit-timestamp\">Тільки нові коментарі або оновлено </label></div></div></div><div class=\"views-exposed-widget views-widget-sort-by\"> <div class=\"form-item form-type-select form-item-sort-by\"> <label for=\"edit-sort-by\">Сортувати за </label> <select id=\"edit-sort-by\" name=\"sort_by\" class=\"form-select\"><option value=\"created\" selected=\"selected\">Дата публікації</option><option value=\"comment_count\">Кількість коментарів</option><option value=\"totalcount\">Усього переглядів</option></select></div></div><div class=\"views-exposed-widget views-widget-sort-order\"> </div><div class=\"views-exposed-widget views-submit-button\"> <input type=\"submit\" id=\"edit-submit-page-taxonomy-term\" name=\"\" value=\"Застосувати\" class=\"form-submit\"/> </div><div class=\"views-exposed-widget views-reset-button\"> <input type=\"submit\" id=\"edit-reset\" name=\"op\" value=\"Скинути\" class=\"form-submit\"/> </div></div></div></div></form> </div><div class=\"view-content\"> <table class=\"views-view-grid cols-2\"> <tbody> <tr class=\"row-1 row-first\"> <td class=\"col-1 col-first grid\"> <div class=\"entity-extra-wrapper\" data-entity_type=\"node\" data-entity_id=\"34480\"><div class=\"ds-1col node node-blog node-promoted node-sticky node-teaser node-odd published with-comments sticky promote node-teaser view-mode-teaser clearfix\"> <div class=\"field field-name-post-date field-type-ds field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\">03.09.2016</div></div></div><div class=\"field field-name-author\"><span class=\"username\">Еней Світлий</span></div><div class=\"field field-name-field-img-teaser field-type-image field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\"><a href=\"/article/hmarnyy-riven-zahystu-narodnogo-oglyadacha-vprovadzheno.html\"><img src=\"https://ar25.org/sites/default/files/styles/teaser280/public/node/2016/09/34480/160903hmara-1.png?itok=blMRIfAO&amp;c=3800933a06161a36b66400e75a831f1b\" alt=\"\"/></a></div></div></div><div class=\"field field-name-title field-type-ds field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\"><div class=\"title\"><a href=\"/article/hmarnyy-riven-zahystu-narodnogo-oglyadacha-vprovadzheno.html\">Хмарний рівень захисту Народного Оглядача - впроваджено!</a></div></div></div></div><div class=\"field field-name-body field-type-text-with-summary field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\">На цьому тижні відвідувачі нашого сайту могли відчути затримки віддачі сайтом \"Народний Оглядач\" його сторінок. При цьому показувана сайтом статистика відвідуваності не збігалась з даними<a href=\"/article/hmarnyy-riven-zahystu-narodnogo-oglyadacha-vprovadzheno.html\" class=\"more-link\">...</a></div></div></div><div class=\"field field-name-observer-ds-field-teaser-links field-type-ds field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\"><span title='Comments counter'class='fa fa-comments-o show'>5</span> <a title='Нові коментарі'class='fa fa-comments hide' href='article/hmarnyy-riven-zahystu-narodnogo-oglyadacha-vprovadzheno.html#new'></a><span title='Article rating'class='fa fa-balance-scale show'>5</span><span title='Page views' class='fa fa-eye'>117</span></div></div></div></div></div></td><td class=\"col-2 col-last grid\"> <div class=\"entity-extra-wrapper\" data-entity_type=\"node\" data-entity_id=\"34467\"><div class=\"ds-1col node node-blog node-promoted node-sticky node-teaser node-even published with-comments sticky promote node-teaser view-mode-teaser clearfix\"> <div class=\"field field-name-post-date field-type-ds field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\">31.08.2016</div></div></div><div class=\"field field-name-author\"><span class=\"username\">Ігор Каганець</span></div><div class=\"field field-name-field-img-teaser field-type-image field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\"><a href=\"/article/piznaymo-istynu-i-vona-zvilnyt-nas-abo-shche-raz-pro-vypravlennya-imen.html\"><img src=\"https://ar25.org/sites/default/files/styles/teaser280/public/node/2016/08/34467/160831isus.jpg?itok=CJQDq1sx&amp;c=941eb13881c83397be407de6cb68875d\" alt=\"Щасливі чесні, бо вони успадкують землю!\" title=\"Щасливі чесні, бо вони успадкують землю!\"/></a></div></div></div><div class=\"field field-name-title field-type-ds field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\"><div class=\"title\"><a href=\"/article/piznaymo-istynu-i-vona-zvilnyt-nas-abo-shche-raz-pro-vypravlennya-imen.html\">Пізнаймо Істину – і вона звільнить нас, або Ще раз про «виправлення імен»</a></div></div></div></div><div class=\"field field-name-body field-type-text-with-summary field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\">Індустріальна формація опустилася до стану тотального обману і самообману. Постіндустріальна формація є її неминучим запереченням, тому має будуватися на тотальній Правді. Майбутнє мають<a href=\"/article/piznaymo-istynu-i-vona-zvilnyt-nas-abo-shche-raz-pro-vypravlennya-imen.html\" class=\"more-link\">...</a></div></div></div><div class=\"field field-name-observer-ds-field-teaser-links field-type-ds field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\"><span title='Comments counter'class='fa fa-comments-o show'>6</span> <a title='Нові коментарі'class='fa fa-comments hide' href='article/piznaymo-istynu-i-vona-zvilnyt-nas-abo-shche-raz-pro-vypravlennya-imen.html#new'></a><span title='Article rating'class='fa fa-balance-scale show'>4</span><span title='Page views' class='fa fa-eye'>475</span></div></div></div></div></div></td></tr><tr class=\"row-2\"> <td class=\"col-1 col-first grid\"> <div class=\"entity-extra-wrapper\" data-entity_type=\"node\" data-entity_id=\"31837\"><div class=\"ds-1col node node-blog node-promoted node-sticky node-teaser node-odd published with-comments sticky promote node-teaser view-mode-teaser clearfix\"> <div class=\"field field-name-post-date field-type-ds field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\">30.10.2015</div></div></div><div class=\"field field-name-author\"><span class=\"username\">Ігор Каганець</span></div><div class=\"field field-name-field-img-teaser field-type-image field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\"><a href=\"/article/postindustrialna-cyvilizaciya-mizhmorya-ssha-i-vilna-ukrayinska-derzhava-zaproshuyemo-do\"><img src=\"https://ar25.org/sites/default/files/styles/teaser280/public/151030-perehid.jpg?itok=HgCEX3By&amp;c=44c5347bcba5e1bb9d416c99c7b406a9\" alt=\"Постіндустріальна цивілізація, нова Золота ера. Злітаймо! \" title=\"Постіндустріальна цивілізація, нова Золота ера. Злітаймо! \"/></a></div></div></div><div class=\"field field-name-title field-type-ds field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\"><div class=\"title\"><a href=\"/article/postindustrialna-cyvilizaciya-mizhmorya-ssha-i-vilna-ukrayinska-derzhava-zaproshuyemo-do\">Постіндустріальна цивілізація Міжмор’я, США і Вільна Українська Держава: запрошуємо до стартапу</a></div></div></div></div><div class=\"field field-name-body field-type-text-with-summary field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\">Що швидше США, Польща та Литва підтримають процес самоорганізації українського творчого класу і заснування ним нової держави, то швидше отримають потужного гравця у творенні нової Європи і<a href=\"/article/postindustrialna-cyvilizaciya-mizhmorya-ssha-i-vilna-ukrayinska-derzhava-zaproshuyemo-do\" class=\"more-link\">...</a></div></div></div><div class=\"field field-name-observer-ds-field-teaser-links field-type-ds field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\"><span title='Comments counter'class='fa fa-comments-o show'>20</span> <a title='Нові коментарі'class='fa fa-comments hide' href='article/postindustrialna-cyvilizaciya-mizhmorya-ssha-i-vilna-ukrayinska-derzhava-zaproshuyemo-do#new'></a><span title='Article rating'class='fa fa-balance-scale hide'></span><span title='Page views' class='fa fa-eye'>3497</span></div></div></div></div></div></td><td class=\"col-2 col-last grid\"> <div class=\"entity-extra-wrapper\" data-entity_type=\"node\" data-entity_id=\"34497\"><div class=\"ds-1col node node-blog node-teaser node-even published with-comments node-teaser view-mode-teaser clearfix\"> <div class=\"field field-name-post-date field-type-ds field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\">05.09.2016</div></div></div><div class=\"field field-name-author\"><span class=\"username\">Олена Каганець</span></div><div class=\"field field-name-field-img-teaser field-type-image field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\"><a href=\"/article/nayblyzhchi-misyaci-budut-duzhe-nebezpechnymy-dlya-ukrayiny-times.html-0\"><img src=\"https://ar25.org/sites/default/files/styles/teaser280/public/node/2016/09/34497/putin.jpg?itok=u8KsYzjA&amp;c=c675973bbe8b4232deb043c1785cfa54\" alt=\"\"/></a></div></div></div><div class=\"field field-name-title field-type-ds field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\"><div class=\"title\"><a href=\"/article/nayblyzhchi-misyaci-budut-duzhe-nebezpechnymy-dlya-ukrayiny-times.html-0\">Найближчі місяці будуть дуже небезпечними для України – The Times </a></div></div></div></div><div class=\"field field-name-body field-type-text-with-summary field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\">Перемога Клінтон на виборах лякає Путіна, але в нього все одно буде місяць фори. У Путіна лишилося небагато часу, щоб вийти переможцем з усіх військових авантюр.<a href=\"/article/nayblyzhchi-misyaci-budut-duzhe-nebezpechnymy-dlya-ukrayiny-times.html-0\" class=\"more-link\">...</a></div></div></div><div class=\"field field-name-observer-ds-field-teaser-links field-type-ds field-label-hidden\"><div class=\"field-items\"><div class=\"field-item even\"><span title='Comments counter'class='fa fa-comments-o show'>1</span> <a title='Нові коментарі'class='fa fa-comments hide' href='article/nayblyzhchi-misyaci-budut-duzhe-nebezpechnymy-dlya-ukrayiny-times.html-0#new'></a><span title='Article rating'class='fa fa-balance-scale show'>3</span><span title='Page views' class='fa fa-eye'></span></div></div></div></div></div></td></tr></tbody></table> </div><table class=\"pagerer\"><tbody> <tr><td></td><td class=\"pagerer pagerer-center\"><h2 class=\"element-invisible\">Сторінки</h2><div class=\"pagerer-pager \"><div class=\"item-list\"><ul class=\"pager\"><li class=\"pager-item first\">Сторінка</li><li class=\"pager-item widget active\"><input type=\"text\" class=\"pagerer-page\" name='{\"path\":\"taxonomy\\/term\\/684?timestamp=0\\u0026created=All\\u0026sort_by=created\\u0026page=0%2Cpagererpage\",\"element\":1,\"quantity\":\"9\",\"total\":923,\"totalItems\":\"18450\",\"current\":0,\"interval\":1,\"display\":\"pages\",\"pagerSeparator\":\"none\",\"rangeSeparator\":\"-\",\"pageTag\":\"@number\",\"widgetResize\":1}' title=\"Enter page, then press Return.\" value=\"1\"/></li><li class=\"pager-item\">of 923</li><li class=\"pager-next active last\"><a title=\"До наступної сторінки\" href=\"/svity?timestamp=0&amp;created=All&amp;sort_by=created&amp;page=0%2C1\">&gt;</a></li></ul></div></div></td><td></td></tr></tbody></table> </div><div class=\"hr clearfix\">&nbsp;</div></div></div></div><aside id=\"sidebar-first\" class=\"column sidebar sb1\" role=\"complementary\"> <section id=\"block-block-13\" class=\"block block-block block-odd\"> <h2>Дзеркало сайту</h2> <div class=\"content\"> <div id=\"site-mirror\" class=\"rtecenter\">Розташоване за адресою:<br/><a href=\"http://mirror.ar25.org/\">http://mirror.ar25.org/</a><br/><em>(лише для читання)</em></div></div></section><section id=\"block-views-a691ffe5ff9b73bdf91ad3661fb21ff0\" class=\"block block-views block-even\"> <h2>Найбільш коментовані</h2> <div class=\"content\"> <div class=\"view view-block-top-comments view-id-block_top_comments view-display-id-block_top_comments view-dom-id-7cebcace4c2edf74d9d7307f9b9feae5\"> <div class=\"view-filters\"> <form class=\"ctools-auto-submit-full-form\" action=\"/en\" method=\"get\" id=\"views-exposed-form-block-top-comments-block-top-comments\" accept-charset=\"UTF-8\"><div><div class=\"views-exposed-form\"> <div class=\"views-exposed-widgets clearfix\"> <div id=\"edit-created-top-comments-wrapper\" class=\"views-exposed-widget views-widget-filter-created_top_comments\"> <div class=\"views-widget\"> <div id=\"edit-created-top-comments\" class=\"form-radios\"><div class=\"form-item form-type-radio form-item-created-top-comments\"> <input type=\"radio\" id=\"edit-created-top-comments-all\" name=\"created_top_comments\" value=\"All\" checked=\"checked\" class=\"form-radio\"/> <label class=\"option\" for=\"edit-created-top-comments-all\">загалом </label></div><div class=\"form-item form-type-radio form-item-created-top-comments\"> <input type=\"radio\" id=\"edit-created-top-comments-1\" name=\"created_top_comments\" value=\"1\" class=\"form-radio\"/> <label class=\"option\" for=\"edit-created-top-comments-1\">за день </label></div><div class=\"form-item form-type-radio form-item-created-top-comments\"> <input type=\"radio\" id=\"edit-created-top-comments-2\" name=\"created_top_comments\" value=\"2\" class=\"form-radio\"/> <label class=\"option\" for=\"edit-created-top-comments-2\">за тиждень </label></div><div class=\"form-item form-type-radio form-item-created-top-comments\"> <input type=\"radio\" id=\"edit-created-top-comments-3\" name=\"created_top_comments\" value=\"3\" class=\"form-radio\"/> <label class=\"option\" for=\"edit-created-top-comments-3\">за місяць </label></div></div></div></div><div class=\"views-exposed-widget views-submit-button\"> <input class=\"ctools-use-ajax ctools-auto-submit-click js-hide form-submit\" type=\"submit\" id=\"edit-submit-block-top-comments\" name=\"\" value=\"Застосувати\"/> </div></div></div></div></form> </div><div class=\"view-content\"> <ul> <li class=\"first odd\"> <a href=\"/en/article/hto-ye-ukrayincem-i-yak-ce-vyznachyty.html\" title=\"Автор - Ігор Каганець\">Хто є українцем і як це визначити</a> <span class=\"fa fa-comments-o\">375<span> </li></ul> </div></div></div></section><a id=\"button-1\" class=\"fixed-button\" href=\"/forum\">Форум</a><a id=\"button-2\" class=\"fixed-button\" href=\"/article/proshu-pidtrymaty-rozrobku-narodnogo-oglyadacha.html\">Підтримати сайт</a><a id=\"button-3\" class=\"fixed-button\" href=\"/faq.html\">Довідка</a> <div class=\"ym-counter\"><script type=\"text/javascript\">(function (d, w, c){(w[c]=w[c] || []).push(function(){try{w.yaCounter20795473=new Ya.Metrika({id:20795473, webvisor:true, clickmap:true, trackLinks:true, accurateTrackBounce:true});}catch(e){}}); var n=d.getElementsByTagName(\"script\")[0], s=d.createElement(\"script\"), f=function (){n.parentNode.insertBefore(s, n);}; s.type=\"text/javascript\"; s.async=true; s.src=(d.location.protocol==\"https:\" ? \"https:\" : \"http:\") + \"//mc.yandex.ru/metrika/watch.js\"; if (w.opera==\"[object Opera]\"){d.addEventListener(\"DOMContentLoaded\", f, false);}else{f();}})(document, window, \"yandex_metrika_callbacks\");</script><noscript><div><img src=\"//mc.yandex.ru/watch/20795473\" style=\"position:absolute; left:-9999px;\" alt=\"\"/></div></noscript></div><div id=\"user_relationships_popup_form\" class=\"user_relationships_ui_popup_form\"></div></body></html>";


  @Rule
  public PowerMockRule rule = new PowerMockRule();

  @Test public void testConvert() throws Exception {
    List expectedData = new ArrayList<Post>(){{

      add(new Post(34480L, "Хмарний рівень захисту Народного Оглядача - впроваджено!", "03.09.2016", "https://ar25.org/sites/default/files/styles/teaser280/public/node/2016/09/34480/160903hmara-1.png", "На цьому тижні відвідувачі нашого сайту могли відчути затримки віддачі сайтом \"Народний Оглядач\" його сторінок. При цьому показувана сайтом статистика відвідуваності не збігалась з даними...", null));
      add(new Post(34467L, "Пізнаймо Істину – і вона звільнить нас, або Ще раз про «виправлення імен»", "31.08.2016", "https://ar25.org/sites/default/files/styles/teaser280/public/node/2016/08/34467/160831isus.jpg", "Індустріальна формація опустилася до стану тотального обману і самообману. Постіндустріальна формація є її неминучим запереченням, тому має будуватися на тотальній Правді. Майбутнє мають...", null));
    }};


    HtmlResponsePostsListConverter converter = new HtmlResponsePostsListConverter();

    ResponseBody responseBody = PowerMockito.mock(ResponseBody.class);
    PowerMockito.when(responseBody.string()).thenReturn(mTestHtml);

    List<Post> result = converter.convert(responseBody);

    assertTrue(result.containsAll(expectedData));
  }
}